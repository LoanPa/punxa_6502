                                      1 ;-------------------------------------------------------------------------
                                      2 ;   _strcmp.s - standard C library function
                                      3 ;
                                      4 ;   Copyright (C) 1998, Ullrich von Bassewitz
                                      5 ;   Copyright (C) 2022, Gabriele Gorla
                                      6 ;
                                      7 ;   This library is free software; you can redistribute it and/or modify it
                                      8 ;   under the terms of the GNU General Public License as published by the
                                      9 ;   Free Software Foundation; either version 2, or (at your option) any
                                     10 ;   later version.
                                     11 ;
                                     12 ;   This library is distributed in the hope that it will be useful,
                                     13 ;   but WITHOUT ANY WARRANTY; without even the implied warranty of
                                     14 ;   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
                                     15 ;   GNU General Public License for more details.
                                     16 ;
                                     17 ;   You should have received a copy of the GNU General Public License
                                     18 ;   along with this library; see the file COPYING. If not, write to the
                                     19 ;   Free Software Foundation, 51 Franklin Street, Fifth Floor, Boston,
                                     20 ;   MA 02110-1301, USA.
                                     21 ;
                                     22 ;   As a special exception, if you link this library with other files,
                                     23 ;   some of which are compiled with SDCC, to produce an executable,
                                     24 ;   this library does not by itself cause the resulting executable to
                                     25 ;   be covered by the GNU General Public License. This exception does
                                     26 ;   not however invalidate any other reasons why the executable file
                                     27 ;   might be covered by the GNU General Public License.
                                     28 ;-------------------------------------------------------------------------
                                     29 
                                     30 	.module _strcmp
                                     31 
                                     32 ;--------------------------------------------------------
                                     33 ; exported symbols
                                     34 ;--------------------------------------------------------
                                     35 	.globl _strcmp_PARM_2
                                     36 	.globl _strcmp
                                     37 
                                     38 ;--------------------------------------------------------
                                     39 ; overlayable function parameters in zero page
                                     40 ;--------------------------------------------------------
                                     41 	.area	OSEG    (PAG, OVR)
      000000                         42 _strcmp_PARM_2:
      000000                         43 	.ds 2
                                     44 
                                     45 ;--------------------------------------------------------
                                     46 ; local aliases
                                     47 ;--------------------------------------------------------
                                     48 	.define _str2 "_strcmp_PARM_2"
                                     49 	.define _str1 "DPTR"
                                     50 ;--------------------------------------------------------
                                     51 ; code
                                     52 ;--------------------------------------------------------
                                     53 	.area CODE
                                     54 
      000000                         55 _strcmp:
      000000 85*00            [ 3]   56 	sta	*_str1+0
      000002 86*01            [ 3]   57 	stx	*_str1+1
                                     58 
      000004 A0 00            [ 2]   59 	ldy	#0
      000006                         60 loop:
      000006 B1*00            [ 6]   61 	lda	[_str1],y
      000008 D1*00            [ 6]   62 	cmp	[_str2],y
      00000A D0 0C            [ 4]   63 	bne	L1
      00000C AA               [ 2]   64 	tax
      00000D F0 0E            [ 4]   65 	beq	end
      00000F C8               [ 2]   66 	iny
      000010 D0 F4            [ 4]   67 	bne	loop
      000012 E6*01            [ 5]   68 	inc	*_str1+1
      000014 E6*01            [ 5]   69 	inc	*_str2+1
      000016 D0 EE            [ 4]   70 	bne	loop
      000018                         71 L1:
                                     72 ; return the exact difference - common behavior but not required by the standard
                                     73 ;	sec
                                     74 ;	sbc	[_str2],y
                                     75 
      000018 A2 00            [ 2]   76 	ldx	#0x00
      00001A B0 01            [ 4]   77 	bcs	end
      00001C CA               [ 2]   78 	dex
      00001D                         79 end:
      00001D 60               [ 6]   80 	rts
