                                      1 ;--------------------------------------------------------
                                      2 ; File Created by SDCC : free open source ISO C Compiler
                                      3 ; Version 4.5.10 #15691 (Linux)
                                      4 ;--------------------------------------------------------
                                      5 	.module free
                                      6 	
                                      7 	.optsdcc -mmos6502
                                      8 
                                      9 ;--------------------------------------------------------
                                     10 ;  Ordering of segments for the linker.
                                     11 ;--------------------------------------------------------
                                     12 	.area ZP      (PAG)
                                     13 	.area OSEG    (PAG, OVR)
                                     14 	.area _CODE
                                     15 	.area GSINIT
                                     16 	.area GSFINAL
                                     17 	.area CODE
                                     18 	.area RODATA
                                     19 	.area XINIT
                                     20 	.area _DATA
                                     21 	.area DATA
                                     22 	.area BSS
                                     23 ;--------------------------------------------------------
                                     24 ; Public variables in this module
                                     25 ;--------------------------------------------------------
                                     26 	.globl _free
                                     27 ;--------------------------------------------------------
                                     28 ; ZP ram data
                                     29 ;--------------------------------------------------------
                                     30 	.area ZP      (PAG)
                                     31 ;--------------------------------------------------------
                                     32 ; overlayable items in ram
                                     33 ;--------------------------------------------------------
                                     34 	.area	OSEG    (PAG, OVR)
      000000                         35 _free_sloc0_1_0:
      000000                         36 	.ds 2
      000002                         37 _free_sloc1_1_0:
      000002                         38 	.ds 2
      000004                         39 _free_sloc2_1_0:
      000004                         40 	.ds 2
                                     41 ;--------------------------------------------------------
                                     42 ; uninitialized external ram data
                                     43 ;--------------------------------------------------------
                                     44 	.area BSS
      000000                         45 _free_ptr_10000_43:
      000000                         46 	.ds 2
      000002                         47 _free_h_10000_44:
      000002                         48 	.ds 2
      000004                         49 _free_next_free_10000_44:
      000004                         50 	.ds 2
      000006                         51 _free_prev_free_10000_44:
      000006                         52 	.ds 2
      000008                         53 _free_f_10000_44:
      000008                         54 	.ds 2
                                     55 ;--------------------------------------------------------
                                     56 ; absolute external ram data
                                     57 ;--------------------------------------------------------
                                     58 	.area DABS    (ABS)
                                     59 ;--------------------------------------------------------
                                     60 ; initialized external ram data
                                     61 ;--------------------------------------------------------
                                     62 	.area DATA
                                     63 ;--------------------------------------------------------
                                     64 ; global & static initialisations
                                     65 ;--------------------------------------------------------
                                     66 	.area _CODE
                                     67 	.area GSINIT
                                     68 	.area GSFINAL
                                     69 	.area GSINIT
                                     70 ;--------------------------------------------------------
                                     71 ; Home
                                     72 ;--------------------------------------------------------
                                     73 	.area _CODE
                                     74 	.area _CODE
                                     75 ;--------------------------------------------------------
                                     76 ; code
                                     77 ;--------------------------------------------------------
                                     78 	.area CODE
                                     79 ;------------------------------------------------------------
                                     80 ;Allocation info for local variables in function 'free'
                                     81 ;------------------------------------------------------------
                                     82 ;ptr           Allocated with name '_free_ptr_10000_43'
                                     83 ;h             Allocated with name '_free_h_10000_44'
                                     84 ;next_free     Allocated with name '_free_next_free_10000_44'
                                     85 ;prev_free     Allocated with name '_free_prev_free_10000_44'
                                     86 ;f             Allocated with name '_free_f_10000_44'
                                     87 ;sloc0         Allocated with name '_free_sloc0_1_0'
                                     88 ;sloc1         Allocated with name '_free_sloc1_1_0'
                                     89 ;sloc2         Allocated with name '_free_sloc2_1_0'
                                     90 ;------------------------------------------------------------
                                     91 ;	../free.c: 50: void free(void *ptr)
                                     92 ;	genLabel
                                     93 ;	Raw cost for generated ic 0 : (0, 0.000000) count=1.000000
                                     94 ;	-----------------------------------------
                                     95 ;	 function free
                                     96 ;	-----------------------------------------
                                     97 ;	Register assignment is optimal.
                                     98 ;	Stack space usage: 0 bytes.
      000000                         99 _free:
                                    100 ;	Raw cost for generated ic 1 : (0, 0.000000) count=1.000000
                                    101 ;	genReceive
      000000 8Dr00r00         [ 4]  102 	sta	_free_ptr_10000_43
      000003 8Er01r00         [ 4]  103 	stx	(_free_ptr_10000_43 + 1)
                                    104 ;	Raw cost for generated ic 2 : (6, 8.000000) count=1.000000
                                    105 ;	../free.c: 55: if(!ptr)
                                    106 ;	genIfx
      000006 8A               [ 2]  107 	txa
      000007 0Dr00r00         [ 4]  108 	ora	_free_ptr_10000_43
                                    109 ;	genIfxJump : z
      00000A D0 01            [ 4]  110 	bne	00102$
                                    111 ;	Raw cost for generated ic 3 : (9, 11.600000) count=1.000000
                                    112 ;	../free.c: 56: return;
                                    113 ;	genRet
      00000C 60               [ 6]  114 	rts
                                    115 ;	Raw cost for generated ic 6 : (3, 3.000000) count=0.750000
                                    116 ;	genLabel
      00000D                        117 00102$:
                                    118 ;	Raw cost for generated ic 7 : (0, 0.000000) count=1.000000
                                    119 ;	../free.c: 58: prev_free = 0;
                                    120 ;	genAssign
                                    121 ;	genAssignLit
      00000D A0 00            [ 2]  122 	ldy	#0x00
      00000F 8Cr06r00         [ 4]  123 	sty	_free_prev_free_10000_44
      000012 8Cr07r00         [ 4]  124 	sty	(_free_prev_free_10000_44 + 1)
                                    125 ;	Raw cost for generated ic 9 : (8, 10.000000) count=1.000000
                                    126 ;	../free.c: 59: for(h = __sdcc_heap_free, f = &__sdcc_heap_free; h && h < ptr; prev_free = h, f = &(h->next_free), h = h->next_free); // Find adjacent blocks in free list
                                    127 ;	genAssign
                                    128 ;	genCopy
      000015 AEr01r00         [ 4]  129 	ldx	(___sdcc_heap_free + 1)
      000018 ADr00r00         [ 4]  130 	lda	___sdcc_heap_free
                                    131 ;	Raw cost for generated ic 10 : (6, 8.000000) count=1.000000
                                    132 ;	skipping iCode since result will be rematerialized
                                    133 ;	Raw cost for generated ic 11 : (0, 0.000000) count=1.000000
                                    134 ;	genCast
                                    135 ;	genCopy
      00001B A0s00            [ 2]  136 	ldy	#>___sdcc_heap_free
      00001D 8Cr09r00         [ 4]  137 	sty	(_free_f_10000_44 + 1)
      000020 A0r00            [ 2]  138 	ldy	#___sdcc_heap_free
      000022 8Cr08r00         [ 4]  139 	sty	_free_f_10000_44
                                    140 ;	Raw cost for generated ic 12 : (10, 12.000000) count=1.000000
                                    141 ;	genLabel
      000025                        142 00111$:
                                    143 ;	Raw cost for generated ic 14 : (0, 0.000000) count=2.285713
                                    144 ;	genIfx
      000025 C9 00            [ 2]  145 	cmp	#0x00
                                    146 ;	genIfxJump : z
      000027 D0 04            [ 4]  147 	bne	00167$
      000029 E0 00            [ 2]  148 	cpx	#0x00
      00002B F0 37            [ 4]  149 	beq	00103$
      00002D                        150 00167$:
                                    151 ;	Raw cost for generated ic 15 : (11, 12.200000) count=2.285713
                                    152 ;	genCast
                                    153 ;	genCopy
      00002D ACr01r00         [ 4]  154 	ldy	(_free_ptr_10000_43 + 1)
      000030 84*01            [ 3]  155 	sty	*(_free_sloc0_1_0 + 1)
      000032 ACr00r00         [ 4]  156 	ldy	_free_ptr_10000_43
      000035 84*00            [ 3]  157 	sty	*_free_sloc0_1_0
                                    158 ;	Raw cost for generated ic 18 : (10, 14.000000) count=1.714284
                                    159 ;	genCmp
      000037 85*00            [ 3]  160 	sta	*(REGTEMP+0)
      000039 38               [ 2]  161 	sec
      00003A E5*00            [ 3]  162 	sbc	*_free_sloc0_1_0
      00003C 8A               [ 2]  163 	txa
      00003D E5*01            [ 3]  164 	sbc	*(_free_sloc0_1_0 + 1)
      00003F A5*00            [ 3]  165 	lda	*(REGTEMP+0)
      000041 B0 21            [ 4]  166 	bcs	00103$
                                    167 ;	Raw cost for generated ic 19 : (15, 21.600000) count=1.714284
                                    168 ;	skipping generated iCode
                                    169 ;	Raw cost for generated ic 20 : (0, 0.000000) count=1.714284
                                    170 ;	genAssign
                                    171 ;	genCopy
      000043 8Dr06r00         [ 4]  172 	sta	_free_prev_free_10000_44
      000046 8Er07r00         [ 4]  173 	stx	(_free_prev_free_10000_44 + 1)
                                    174 ;	Raw cost for generated ic 24 : (6, 8.000000) count=1.285713
                                    175 ;	genPlus
                                    176 ;	  genPlusInc
      000049 18               [ 2]  177 	clc
      00004A 69 02            [ 2]  178 	adc	#0x02
      00004C 90 01            [ 4]  179 	bcc	00169$
      00004E E8               [ 2]  180 	inx
      00004F                        181 00169$:
                                    182 ;	Raw cost for generated ic 26 : (6, 8.600000) count=1.285713
                                    183 ;	genAssign
                                    184 ;	genCopy
      00004F 8Dr08r00         [ 4]  185 	sta	_free_f_10000_44
      000052 8Er09r00         [ 4]  186 	stx	(_free_f_10000_44 + 1)
                                    187 ;	Raw cost for generated ic 27 : (6, 8.000000) count=1.285713
                                    188 ;	genPointerGet
                                    189 ;	  setupDPTR - off=0 remat=(null) savea=0
      000055 85*00            [ 3]  190 	sta	*(DPTR+0)
      000057 86*01            [ 3]  191 	stx	*(DPTR+1)
      000059 A0 01            [ 2]  192 	ldy	#0x01
      00005B B1*00            [ 6]  193 	lda	[DPTR],y
      00005D AA               [ 2]  194 	tax
      00005E 88               [ 2]  195 	dey
      00005F B1*00            [ 6]  196 	lda	[DPTR],y
                                    197 ;	Raw cost for generated ic 30 : (12, 22.000000) count=1.285713
                                    198 ;	genGoto
      000061 4Cr25r00         [ 3]  199 	jmp	00111$
                                    200 ;	Raw cost for generated ic 32 : (3, 3.000000) count=1.285713
                                    201 ;	genLabel
      000064                        202 00103$:
                                    203 ;	Raw cost for generated ic 33 : (0, 0.000000) count=0.999999
                                    204 ;	../free.c: 60: next_free = h;
                                    205 ;	genAssign
                                    206 ;	genCopy
      000064 8Dr04r00         [ 4]  207 	sta	_free_next_free_10000_44
      000067 8Er05r00         [ 4]  208 	stx	(_free_next_free_10000_44 + 1)
                                    209 ;	Raw cost for generated ic 34 : (6, 8.000000) count=0.999999
                                    210 ;	../free.c: 62: h = (void HEAPSPACE *)((char HEAPSPACE *)(ptr) - offsetof(struct header, next_free));
                                    211 ;	genCast
                                    212 ;	genCopy
      00006A AEr01r00         [ 4]  213 	ldx	(_free_ptr_10000_43 + 1)
      00006D ADr00r00         [ 4]  214 	lda	_free_ptr_10000_43
                                    215 ;	Raw cost for generated ic 35 : (6, 8.000000) count=0.999999
                                    216 ;	genMinus
                                    217 ;	  genMinusDec - size=2  icount=2
      000070 38               [ 2]  218 	sec
      000071 E9 02            [ 2]  219 	sbc	#0x02
      000073 B0 01            [ 4]  220 	bcs	00170$
      000075 CA               [ 2]  221 	dex
      000076                        222 00170$:
                                    223 ;	Raw cost for generated ic 36 : (6, 8.600000) count=0.999999
                                    224 ;	genCast
                                    225 ;	genCopy
      000076 8Dr02r00         [ 4]  226 	sta	_free_h_10000_44
      000079 8Er03r00         [ 4]  227 	stx	(_free_h_10000_44 + 1)
                                    228 ;	Raw cost for generated ic 38 : (6, 8.000000) count=0.999999
                                    229 ;	../free.c: 65: h->next_free = next_free;
                                    230 ;	genAssign
                                    231 ;	genCopy
      00007C 85*00            [ 3]  232 	sta	*_free_sloc0_1_0
      00007E 86*01            [ 3]  233 	stx	*(_free_sloc0_1_0 + 1)
                                    234 ;	Raw cost for generated ic 41 : (4, 6.000000) count=0.999999
                                    235 ;	genPointerSet
      000080 ADr04r00         [ 4]  236 	lda	_free_next_free_10000_44
      000083 A0 02            [ 2]  237 	ldy	#0x02
      000085 91*00            [ 6]  238 	sta	[*_free_sloc0_1_0],y
      000087 ADr05r00         [ 4]  239 	lda	(_free_next_free_10000_44 + 1)
      00008A C8               [ 2]  240 	iny
      00008B 91*00            [ 6]  241 	sta	[*_free_sloc0_1_0],y
                                    242 ;	Raw cost for generated ic 42 : (13, 24.000000) count=0.999999
                                    243 ;	../free.c: 66: *f = h;
                                    244 ;	genPointerSet
                                    245 ;	  setupDPTR - off=0 remat=(null) savea=0
      00008D AEr08r00         [ 4]  246 	ldx	_free_f_10000_44
      000090 86*00            [ 3]  247 	stx	*(DPTR+0)
      000092 AEr09r00         [ 4]  248 	ldx	(_free_f_10000_44 + 1)
      000095 86*01            [ 3]  249 	stx	*(DPTR+1)
      000097 ADr02r00         [ 4]  250 	lda	_free_h_10000_44
      00009A A0 00            [ 2]  251 	ldy	#0x00
      00009C 91*00            [ 6]  252 	sta	[DPTR],y
      00009E ADr03r00         [ 4]  253 	lda	(_free_h_10000_44 + 1)
      0000A1 C8               [ 2]  254 	iny
      0000A2 91*00            [ 6]  255 	sta	[DPTR],y
                                    256 ;	Raw cost for generated ic 44 : (23, 38.000000) count=0.999999
                                    257 ;	../free.c: 68: if(next_free == h->next) // Merge with next block
                                    258 ;	genCast
                                    259 ;	genCopy
      0000A4 85*03            [ 3]  260 	sta	*(_free_sloc1_1_0 + 1)
      0000A6 ADr02r00         [ 4]  261 	lda	_free_h_10000_44
      0000A9 85*02            [ 3]  262 	sta	*_free_sloc1_1_0
                                    263 ;	Raw cost for generated ic 46 : (7, 10.000000) count=0.999999
                                    264 ;	genPointerGet
      0000AB B1*02            [ 6]  265 	lda	[*_free_sloc1_1_0],y
      0000AD AA               [ 2]  266 	tax
      0000AE 88               [ 2]  267 	dey
      0000AF B1*02            [ 6]  268 	lda	[*_free_sloc1_1_0],y
                                    269 ;	Raw cost for generated ic 47 : (6, 14.000000) count=0.999999
                                    270 ;	genCmpEQorNE
      0000B1 CDr04r00         [ 4]  271 	cmp	_free_next_free_10000_44
      0000B4 D0 2E            [ 4]  272 	bne	00105$
      0000B6 ECr05r00         [ 4]  273 	cpx	(_free_next_free_10000_44 + 1)
      0000B9 D0 29            [ 4]  274 	bne	00105$
                                    275 ;	Raw cost for generated ic 48 : (16, 19.200001) count=0.999999
                                    276 ;	skipping generated iCode
                                    277 ;	Raw cost for generated ic 49 : (0, 0.000000) count=0.999999
                                    278 ;	../free.c: 70: h->next_free = h->next->next_free;
                                    279 ;	genAssign
                                    280 ;	genCopy
                                    281 ;	Raw cost for generated ic 57 : (0, 0.000000) count=0.749999
                                    282 ;	genPointerGet
                                    283 ;	  setupDPTR - off=2 remat=(null) savea=0
      0000BB 85*00            [ 3]  284 	sta	*(DPTR+0)
      0000BD 86*01            [ 3]  285 	stx	*(DPTR+1)
      0000BF A0 03            [ 2]  286 	ldy	#0x03
      0000C1 B1*00            [ 6]  287 	lda	[DPTR],y
      0000C3 AA               [ 2]  288 	tax
      0000C4 88               [ 2]  289 	dey
      0000C5 B1*00            [ 6]  290 	lda	[DPTR],y
                                    291 ;	Raw cost for generated ic 58 : (12, 22.000000) count=0.749999
                                    292 ;	genPointerSet
      0000C7 91*00            [ 6]  293 	sta	[*_free_sloc0_1_0],y
      0000C9 8A               [ 2]  294 	txa
      0000CA C8               [ 2]  295 	iny
      0000CB 91*00            [ 6]  296 	sta	[*_free_sloc0_1_0],y
                                    297 ;	Raw cost for generated ic 59 : (6, 16.000000) count=0.749999
                                    298 ;	../free.c: 71: h->next = h->next->next;
                                    299 ;	genPointerGet
      0000CD A0 00            [ 2]  300 	ldy	#0x00
      0000CF B1*02            [ 6]  301 	lda	[*_free_sloc1_1_0],y
      0000D1 85*04            [ 3]  302 	sta	*_free_sloc2_1_0
      0000D3 C8               [ 2]  303 	iny
      0000D4 B1*02            [ 6]  304 	lda	[*_free_sloc1_1_0],y
      0000D6 85*05            [ 3]  305 	sta	*(_free_sloc2_1_0 + 1)
                                    306 ;	Raw cost for generated ic 64 : (11, 20.000000) count=0.749999
                                    307 ;	genPointerGet
      0000D8 B1*04            [ 6]  308 	lda	[*_free_sloc2_1_0],y
      0000DA AA               [ 2]  309 	tax
      0000DB 88               [ 2]  310 	dey
      0000DC B1*04            [ 6]  311 	lda	[*_free_sloc2_1_0],y
                                    312 ;	Raw cost for generated ic 66 : (6, 14.000000) count=0.749999
                                    313 ;	genPointerSet
      0000DE 91*02            [ 6]  314 	sta	[*_free_sloc1_1_0],y
      0000E0 8A               [ 2]  315 	txa
      0000E1 C8               [ 2]  316 	iny
      0000E2 91*02            [ 6]  317 	sta	[*_free_sloc1_1_0],y
                                    318 ;	Raw cost for generated ic 67 : (6, 16.000000) count=0.749999
                                    319 ;	genLabel
      0000E4                        320 00105$:
                                    321 ;	Raw cost for generated ic 68 : (0, 0.000000) count=0.999998
                                    322 ;	../free.c: 74: if (prev_free && prev_free->next == h) // Merge with previous block
                                    323 ;	genIfx
      0000E4 ADr07r00         [ 4]  324 	lda	(_free_prev_free_10000_44 + 1)
      0000E7 0Dr06r00         [ 4]  325 	ora	_free_prev_free_10000_44
                                    326 ;	genIfxJump : z
      0000EA F0 42            [ 4]  327 	beq	00113$
                                    328 ;	Raw cost for generated ic 69 : (11, 13.600000) count=0.999998
                                    329 ;	genCast
                                    330 ;	genCopy
      0000EC ADr07r00         [ 4]  331 	lda	(_free_prev_free_10000_44 + 1)
      0000EF 85*05            [ 3]  332 	sta	*(_free_sloc2_1_0 + 1)
      0000F1 ADr06r00         [ 4]  333 	lda	_free_prev_free_10000_44
      0000F4 85*04            [ 3]  334 	sta	*_free_sloc2_1_0
                                    335 ;	Raw cost for generated ic 73 : (10, 14.000000) count=0.749999
                                    336 ;	genPointerGet
      0000F6 A0 01            [ 2]  337 	ldy	#0x01
      0000F8 B1*04            [ 6]  338 	lda	[*_free_sloc2_1_0],y
      0000FA AA               [ 2]  339 	tax
      0000FB 88               [ 2]  340 	dey
      0000FC B1*04            [ 6]  341 	lda	[*_free_sloc2_1_0],y
                                    342 ;	Raw cost for generated ic 74 : (8, 16.000000) count=0.749999
                                    343 ;	genCmpEQorNE
      0000FE CDr02r00         [ 4]  344 	cmp	_free_h_10000_44
      000101 D0 2B            [ 4]  345 	bne	00113$
      000103 ECr03r00         [ 4]  346 	cpx	(_free_h_10000_44 + 1)
      000106 F0 01            [ 4]  347 	beq	00178$
      000108 60               [ 6]  348 	rts
      000109                        349 00178$:
                                    350 ;	Raw cost for generated ic 75 : (16, 19.200001) count=0.749999
                                    351 ;	skipping generated iCode
                                    352 ;	Raw cost for generated ic 76 : (0, 0.000000) count=0.749999
                                    353 ;	../free.c: 76: prev_free->next = h->next;
                                    354 ;	genPointerGet
      000109 C8               [ 2]  355 	iny
      00010A B1*02            [ 6]  356 	lda	[*_free_sloc1_1_0],y
      00010C AA               [ 2]  357 	tax
      00010D 88               [ 2]  358 	dey
      00010E B1*02            [ 6]  359 	lda	[*_free_sloc1_1_0],y
                                    360 ;	Raw cost for generated ic 83 : (7, 16.000000) count=0.562498
                                    361 ;	genPointerSet
      000110 91*04            [ 6]  362 	sta	[*_free_sloc2_1_0],y
      000112 8A               [ 2]  363 	txa
      000113 C8               [ 2]  364 	iny
      000114 91*04            [ 6]  365 	sta	[*_free_sloc2_1_0],y
                                    366 ;	Raw cost for generated ic 84 : (6, 16.000000) count=0.562498
                                    367 ;	../free.c: 77: prev_free->next_free = h->next_free;
                                    368 ;	genAssign
                                    369 ;	genCopy
      000116 ADr07r00         [ 4]  370 	lda	(_free_prev_free_10000_44 + 1)
      000119 85*05            [ 3]  371 	sta	*(_free_sloc2_1_0 + 1)
      00011B ADr06r00         [ 4]  372 	lda	_free_prev_free_10000_44
      00011E 85*04            [ 3]  373 	sta	*_free_sloc2_1_0
                                    374 ;	Raw cost for generated ic 86 : (10, 14.000000) count=0.562498
                                    375 ;	genPointerGet
      000120 A0 03            [ 2]  376 	ldy	#0x03
      000122 B1*00            [ 6]  377 	lda	[*_free_sloc0_1_0],y
      000124 AA               [ 2]  378 	tax
      000125 88               [ 2]  379 	dey
      000126 B1*00            [ 6]  380 	lda	[*_free_sloc0_1_0],y
                                    381 ;	Raw cost for generated ic 89 : (8, 16.000000) count=0.562498
                                    382 ;	genPointerSet
      000128 91*04            [ 6]  383 	sta	[*_free_sloc2_1_0],y
      00012A 8A               [ 2]  384 	txa
      00012B C8               [ 2]  385 	iny
      00012C 91*04            [ 6]  386 	sta	[*_free_sloc2_1_0],y
                                    387 ;	Raw cost for generated ic 90 : (6, 16.000000) count=0.562498
                                    388 ;	genLabel
      00012E                        389 00113$:
                                    390 ;	Raw cost for generated ic 92 : (0, 0.000000) count=0.999997
                                    391 ;	../free.c: 79: }
                                    392 ;	genEndFunction
      00012E 60               [ 6]  393 	rts
                                    394 ;	Raw cost for generated ic 93 : (1, 6.000000) count=0.999997
                                    395 	.area CODE
                                    396 	.area RODATA
                                    397 	.area XINIT
                                    398 	.area CABS    (ABS)
