                                      1 ;-------------------------------------------------------------------------
                                      2 ;   _muluchar.s - routine for multiplication of 8 bit (unsigned char)
                                      3 ;
                                      4 ;   Copyright (C) 2009, Ullrich von Bassewitz
                                      5 ;   Copyright (C) 2022-2023, Gabriele Gorla
                                      6 ;
                                      7 ;   This library is free software; you can redistribute it and/or modify it
                                      8 ;   under the terms of the GNU General Public License as published by the
                                      9 ;   Free Software Foundation; either version 2, or (at your option) any
                                     10 ;   later version.
                                     11 ;
                                     12 ;   This library is distributed in the hope that it will be useful,
                                     13 ;   but WITHOUT ANY WARRANTY; without even the implied warranty of
                                     14 ;   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
                                     15 ;   GNU General Public License for more details.
                                     16 ;
                                     17 ;   You should have received a copy of the GNU General Public License
                                     18 ;   along with this library; see the file COPYING. If not, write to the
                                     19 ;   Free Software Foundation, 51 Franklin Street, Fifth Floor, Boston,
                                     20 ;   MA 02110-1301, USA.
                                     21 ;
                                     22 ;   As a special exception, if you link this library with other files,
                                     23 ;   some of which are compiled with SDCC, to produce an executable,
                                     24 ;   this library does not by itself cause the resulting executable to
                                     25 ;   be covered by the GNU General Public License. This exception does
                                     26 ;   not however invalidate any other reasons why the executable file
                                     27 ;   might be covered by the GNU General Public License.
                                     28 ;-------------------------------------------------------------------------
                                     29 
                                     30 	.module _muluchar
                                     31 
                                     32 ;--------------------------------------------------------
                                     33 ; exported symbols
                                     34 ;--------------------------------------------------------
                                     35 	.globl __muluchar   ; arguments in A and X, result in AX
                                     36 	.globl ___umul8     ; arguments in ret0 and ret1, result in AX
                                     37 
                                     38 ;--------------------------------------------------------
                                     39 ; overlayable function parameters in zero page
                                     40 ;--------------------------------------------------------
                                     41 	.area	OSEG    (PAG, OVR)
                                     42 
                                     43 ;--------------------------------------------------------
                                     44 ; local aliases
                                     45 ;--------------------------------------------------------
                                     46 	.define arg1 "___SDCC_m6502_ret0"
                                     47 	.define arg2 "___SDCC_m6502_ret2"
                                     48 
                                     49 ;--------------------------------------------------------
                                     50 ; code
                                     51 ;--------------------------------------------------------
                                     52 	.area CODE
                                     53 
      000000                         54 __muluchar:
      000000 85*00            [ 3]   55 	sta     *arg1
      000002 86*00            [ 3]   56 	stx	*arg2
      000004                         57 ___umul8:
      000004 A9 00            [ 2]   58         lda     #0              ; Clear byte 1
      000006 A0 08            [ 2]   59         ldy     #8              ; Number of bits
      000008 46*00            [ 5]   60         lsr     *arg2           ; Get first bit of RHS into carry
      00000A 90 03            [ 4]   61 L0:    	bcc	L1
      00000C 18               [ 2]   62         clc
      00000D 65*00            [ 3]   63         adc     *arg1
      00000F 6A               [ 2]   64 L1:    	ror
      000010 66*00            [ 5]   65         ror     *arg2
      000012 88               [ 2]   66         dey
      000013 D0 F5            [ 4]   67         bne    	L0
      000015 AA               [ 2]   68         tax                     ; Load the result MSB
      000016 A5*00            [ 3]   69         lda     *arg2           ; Load the result LSB
      000018 60               [ 6]   70         rts                     ; Done
