                                      1 ;-------------------------------------------------------------------------
                                      2 ;   memcmp.s - standarc C library
                                      3 ;
                                      4 ;   Copyright (C) 2003, Ullrich von Bassewitz
                                      5 ;   Copyright (C) 2009, Christian Krueger
                                      6 ;   Copyright (C) 2023, Gabriele Gorla
                                      7 ;
                                      8 ;   This library is free software; you can redistribute it and/or modify it
                                      9 ;   under the terms of the GNU General Public License as published by the
                                     10 ;   Free Software Foundation; either version 2, or (at your option) any
                                     11 ;   later version.
                                     12 ;
                                     13 ;   This library is distributed in the hope that it will be useful,
                                     14 ;   but WITHOUT ANY WARRANTY; without even the implied warranty of
                                     15 ;   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
                                     16 ;   GNU General Public License for more details.
                                     17 ;
                                     18 ;   You should have received a copy of the GNU General Public License
                                     19 ;   along with this library; see the file COPYING. If not, write to the
                                     20 ;   Free Software Foundation, 51 Franklin Street, Fifth Floor, Boston,
                                     21 ;   MA 02110-1301, USA.
                                     22 ;
                                     23 ;   As a special exception, if you link this library with other files,
                                     24 ;   some of which are compiled with SDCC, to produce an executable,
                                     25 ;   this library does not by itself cause the resulting executable to
                                     26 ;   be covered by the GNU General Public License. This exception does
                                     27 ;   not however invalidate any other reasons why the executable file
                                     28 ;   might be covered by the GNU General Public License.
                                     29 ;-------------------------------------------------------------------------
                                     30 
                                     31 	.module memcmp
                                     32 
                                     33 ;--------------------------------------------------------
                                     34 ; exported symbols
                                     35 ;--------------------------------------------------------
                                     36 	.globl _memcmp_PARM_2
                                     37 	.globl _memcmp_PARM_3
                                     38 	.globl _memcmp
                                     39 
                                     40 ;--------------------------------------------------------
                                     41 ; overlayable function parameters in zero page
                                     42 ;--------------------------------------------------------
                                     43 	.area	OSEG    (PAG, OVR)
      000000                         44 _memcmp_PARM_2:
      000000                         45 	.ds 2
      000002                         46 _memcmp_PARM_3:
      000002                         47 	.ds 2
                                     48 
                                     49 ;--------------------------------------------------------
                                     50 ; local aliases
                                     51 ;--------------------------------------------------------
                                     52 	.define s1    "DPTR"
                                     53 	.define s2    "_memcmp_PARM_2"
                                     54 	.define count "_memcmp_PARM_3"
                                     55 
                                     56 ;--------------------------------------------------------
                                     57 ; code
                                     58 ;--------------------------------------------------------
                                     59 	.area CODE
                                     60 	
                                     61 ;--------------------------------------------------------
                                     62 ; int memcmp (int *s1, int *s2, int count)
                                     63 ;--------------------------------------------------------
                                     64 
      000000                         65 _memcmp:
      000000 85*00            [ 3]   66 	sta	*s1+0
      000002 86*01            [ 3]   67 	stx	*s1+1
      000004 A0 00            [ 2]   68 	ldy	#0
      000006 A6*03            [ 3]   69 	ldx	*count+1
      000008 F0 10            [ 4]   70 	beq	endhi
      00000A                         71 hiloop:
      00000A B1*00            [ 6]   72 	lda	[s1],y
      00000C D1*00            [ 6]   73 	cmp	[s2],y
      00000E D0 1A            [ 4]   74 	bne	noteq
      000010 C8               [ 2]   75 	iny
      000011 D0 F7            [ 4]   76 	bne	hiloop
      000013 E6*01            [ 5]   77 	inc	*s1+1
      000015 E6*01            [ 5]   78 	inc	*s2+1
      000017 CA               [ 2]   79 	dex
      000018 D0 F0            [ 4]   80 	bne	hiloop
      00001A                         81 endhi:
      00001A A6*02            [ 3]   82 	ldx	*count+0
      00001C F0 0A            [ 4]   83 	beq	end
      00001E                         84 loloop:
      00001E B1*00            [ 6]   85 	lda	[s1],y
      000020 D1*00            [ 6]   86 	cmp	[s2],y
      000022 D0 06            [ 4]   87 	bne	noteq
      000024 C8               [ 2]   88 	iny
      000025 CA               [ 2]   89 	dex
      000026 D0 F6            [ 4]   90 	bne	loloop
      000028                         91 end:
      000028 8A               [ 2]   92 	txa
      000029 60               [ 6]   93 	rts
      00002A                         94 noteq:
      00002A B0 03            [ 4]   95 	bcs	L2
      00002C A2 FF            [ 2]   96 	ldx	#0xFF
      00002E 60               [ 6]   97 	rts
      00002F                         98 L2:
      00002F A2 01            [ 2]   99 	ldx	#0x01
      000031 60               [ 6]  100 	rts
