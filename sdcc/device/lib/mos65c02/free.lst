                                      1 ;--------------------------------------------------------
                                      2 ; File Created by SDCC : free open source ISO C Compiler
                                      3 ; Version 4.5.10 #15691 (Linux)
                                      4 ;--------------------------------------------------------
                                      5 	.module free
                                      6 	
      000000                          7 	.r65c02
                                      8 	.optsdcc -mmos65c02
                                      9 
                                     10 ;--------------------------------------------------------
                                     11 ;  Ordering of segments for the linker.
                                     12 ;--------------------------------------------------------
                                     13 	.area ZP      (PAG)
                                     14 	.area OSEG    (PAG, OVR)
                                     15 	.area _CODE
                                     16 	.area GSINIT
                                     17 	.area GSFINAL
                                     18 	.area CODE
                                     19 	.area RODATA
                                     20 	.area XINIT
                                     21 	.area _DATA
                                     22 	.area DATA
                                     23 	.area BSS
                                     24 ;--------------------------------------------------------
                                     25 ; Public variables in this module
                                     26 ;--------------------------------------------------------
                                     27 	.globl _free
                                     28 ;--------------------------------------------------------
                                     29 ; ZP ram data
                                     30 ;--------------------------------------------------------
                                     31 	.area ZP      (PAG)
                                     32 ;--------------------------------------------------------
                                     33 ; overlayable items in ram
                                     34 ;--------------------------------------------------------
                                     35 	.area	OSEG    (PAG, OVR)
      000000                         36 _free_sloc0_1_0:
      000000                         37 	.ds 2
      000002                         38 _free_sloc1_1_0:
      000002                         39 	.ds 2
      000004                         40 _free_sloc2_1_0:
      000004                         41 	.ds 2
                                     42 ;--------------------------------------------------------
                                     43 ; uninitialized external ram data
                                     44 ;--------------------------------------------------------
                                     45 	.area BSS
      000000                         46 _free_ptr_10000_43:
      000000                         47 	.ds 2
      000002                         48 _free_h_10000_44:
      000002                         49 	.ds 2
      000004                         50 _free_next_free_10000_44:
      000004                         51 	.ds 2
      000006                         52 _free_prev_free_10000_44:
      000006                         53 	.ds 2
      000008                         54 _free_f_10000_44:
      000008                         55 	.ds 2
                                     56 ;--------------------------------------------------------
                                     57 ; absolute external ram data
                                     58 ;--------------------------------------------------------
                                     59 	.area DABS    (ABS)
                                     60 ;--------------------------------------------------------
                                     61 ; initialized external ram data
                                     62 ;--------------------------------------------------------
                                     63 	.area DATA
                                     64 ;--------------------------------------------------------
                                     65 ; global & static initialisations
                                     66 ;--------------------------------------------------------
                                     67 	.area _CODE
                                     68 	.area GSINIT
                                     69 	.area GSFINAL
                                     70 	.area GSINIT
                                     71 ;--------------------------------------------------------
                                     72 ; Home
                                     73 ;--------------------------------------------------------
                                     74 	.area _CODE
                                     75 	.area _CODE
                                     76 ;--------------------------------------------------------
                                     77 ; code
                                     78 ;--------------------------------------------------------
                                     79 	.area CODE
                                     80 ;------------------------------------------------------------
                                     81 ;Allocation info for local variables in function 'free'
                                     82 ;------------------------------------------------------------
                                     83 ;ptr           Allocated with name '_free_ptr_10000_43'
                                     84 ;h             Allocated with name '_free_h_10000_44'
                                     85 ;next_free     Allocated with name '_free_next_free_10000_44'
                                     86 ;prev_free     Allocated with name '_free_prev_free_10000_44'
                                     87 ;f             Allocated with name '_free_f_10000_44'
                                     88 ;sloc0         Allocated with name '_free_sloc0_1_0'
                                     89 ;sloc1         Allocated with name '_free_sloc1_1_0'
                                     90 ;sloc2         Allocated with name '_free_sloc2_1_0'
                                     91 ;------------------------------------------------------------
                                     92 ;	../free.c: 50: void free(void *ptr)
                                     93 ;	genLabel
                                     94 ;	Raw cost for generated ic 0 : (0, 0.000000) count=1.000000
                                     95 ;	-----------------------------------------
                                     96 ;	 function free
                                     97 ;	-----------------------------------------
                                     98 ;	Register assignment is optimal.
                                     99 ;	Stack space usage: 0 bytes.
      000000                        100 _free:
                                    101 ;	Raw cost for generated ic 1 : (0, 0.000000) count=1.000000
                                    102 ;	genReceive
      000000 8Dr00r00         [ 4]  103 	sta	_free_ptr_10000_43
      000003 8Er01r00         [ 4]  104 	stx	(_free_ptr_10000_43 + 1)
                                    105 ;	Raw cost for generated ic 2 : (6, 8.000000) count=1.000000
                                    106 ;	../free.c: 55: if(!ptr)
                                    107 ;	genIfx
      000006 8A               [ 2]  108 	txa
      000007 0Dr00r00         [ 4]  109 	ora	_free_ptr_10000_43
                                    110 ;	genIfxJump : z
      00000A D0 01            [ 4]  111 	bne	00102$
                                    112 ;	Raw cost for generated ic 3 : (9, 11.600000) count=1.000000
                                    113 ;	../free.c: 56: return;
                                    114 ;	genRet
      00000C 60               [ 6]  115 	rts
                                    116 ;	Raw cost for generated ic 6 : (3, 3.000000) count=0.750000
                                    117 ;	genLabel
      00000D                        118 00102$:
                                    119 ;	Raw cost for generated ic 7 : (0, 0.000000) count=1.000000
                                    120 ;	../free.c: 58: prev_free = 0;
                                    121 ;	genAssign
                                    122 ;	genAssignLit
      00000D 9Cr06r00         [ 4]  123 	stz	_free_prev_free_10000_44
      000010 9Cr07r00         [ 4]  124 	stz	(_free_prev_free_10000_44 + 1)
                                    125 ;	Raw cost for generated ic 9 : (6, 8.000000) count=1.000000
                                    126 ;	../free.c: 59: for(h = __sdcc_heap_free, f = &__sdcc_heap_free; h && h < ptr; prev_free = h, f = &(h->next_free), h = h->next_free); // Find adjacent blocks in free list
                                    127 ;	genAssign
                                    128 ;	genCopy
      000013 AEr01r00         [ 4]  129 	ldx	(___sdcc_heap_free + 1)
      000016 ADr00r00         [ 4]  130 	lda	___sdcc_heap_free
                                    131 ;	Raw cost for generated ic 10 : (6, 8.000000) count=1.000000
                                    132 ;	skipping iCode since result will be rematerialized
                                    133 ;	Raw cost for generated ic 11 : (0, 0.000000) count=1.000000
                                    134 ;	genCast
                                    135 ;	genCopy
      000019 A0s00            [ 2]  136 	ldy	#>___sdcc_heap_free
      00001B 8Cr09r00         [ 4]  137 	sty	(_free_f_10000_44 + 1)
      00001E A0r00            [ 2]  138 	ldy	#___sdcc_heap_free
      000020 8Cr08r00         [ 4]  139 	sty	_free_f_10000_44
                                    140 ;	Raw cost for generated ic 12 : (10, 12.000000) count=1.000000
                                    141 ;	genLabel
      000023                        142 00111$:
                                    143 ;	Raw cost for generated ic 14 : (0, 0.000000) count=2.285713
                                    144 ;	genIfx
      000023 C9 00            [ 2]  145 	cmp	#0x00
                                    146 ;	genIfxJump : z
      000025 D0 04            [ 4]  147 	bne	00167$
      000027 E0 00            [ 2]  148 	cpx	#0x00
      000029 F0 37            [ 4]  149 	beq	00103$
      00002B                        150 00167$:
                                    151 ;	Raw cost for generated ic 15 : (11, 12.200000) count=2.285713
                                    152 ;	genCast
                                    153 ;	genCopy
      00002B ACr01r00         [ 4]  154 	ldy	(_free_ptr_10000_43 + 1)
      00002E 84*01            [ 3]  155 	sty	*(_free_sloc0_1_0 + 1)
      000030 ACr00r00         [ 4]  156 	ldy	_free_ptr_10000_43
      000033 84*00            [ 3]  157 	sty	*_free_sloc0_1_0
                                    158 ;	Raw cost for generated ic 18 : (10, 14.000000) count=1.714284
                                    159 ;	genCmp
      000035 85*00            [ 3]  160 	sta	*(REGTEMP+0)
      000037 38               [ 2]  161 	sec
      000038 E5*00            [ 4]  162 	sbc	*_free_sloc0_1_0
      00003A 8A               [ 2]  163 	txa
      00003B E5*01            [ 4]  164 	sbc	*(_free_sloc0_1_0 + 1)
      00003D A5*00            [ 3]  165 	lda	*(REGTEMP+0)
      00003F B0 21            [ 4]  166 	bcs	00103$
                                    167 ;	Raw cost for generated ic 19 : (15, 21.600000) count=1.714284
                                    168 ;	skipping generated iCode
                                    169 ;	Raw cost for generated ic 20 : (0, 0.000000) count=1.714284
                                    170 ;	genAssign
                                    171 ;	genCopy
      000041 8Dr06r00         [ 4]  172 	sta	_free_prev_free_10000_44
      000044 8Er07r00         [ 4]  173 	stx	(_free_prev_free_10000_44 + 1)
                                    174 ;	Raw cost for generated ic 24 : (6, 8.000000) count=1.285713
                                    175 ;	genPlus
                                    176 ;	  genPlusInc
      000047 18               [ 2]  177 	clc
      000048 69 02            [ 3]  178 	adc	#0x02
      00004A 90 01            [ 4]  179 	bcc	00169$
      00004C E8               [ 2]  180 	inx
      00004D                        181 00169$:
                                    182 ;	Raw cost for generated ic 26 : (6, 8.600000) count=1.285713
                                    183 ;	genAssign
                                    184 ;	genCopy
      00004D 8Dr08r00         [ 4]  185 	sta	_free_f_10000_44
      000050 8Er09r00         [ 4]  186 	stx	(_free_f_10000_44 + 1)
                                    187 ;	Raw cost for generated ic 27 : (6, 8.000000) count=1.285713
                                    188 ;	genPointerGet
                                    189 ;	  setupDPTR - off=0 remat=(null) savea=0
      000053 85*00            [ 3]  190 	sta	*(DPTR+0)
      000055 86*01            [ 3]  191 	stx	*(DPTR+1)
      000057 A0 01            [ 2]  192 	ldy	#0x01
      000059 B1*00            [ 6]  193 	lda	[DPTR],y
      00005B AA               [ 2]  194 	tax
      00005C 88               [ 2]  195 	dey
      00005D B1*00            [ 6]  196 	lda	[DPTR],y
                                    197 ;	Raw cost for generated ic 30 : (12, 22.000000) count=1.285713
                                    198 ;	genGoto
      00005F 4Cr23r00         [ 3]  199 	jmp	00111$
                                    200 ;	Raw cost for generated ic 32 : (3, 3.000000) count=1.285713
                                    201 ;	genLabel
      000062                        202 00103$:
                                    203 ;	Raw cost for generated ic 33 : (0, 0.000000) count=0.999999
                                    204 ;	../free.c: 60: next_free = h;
                                    205 ;	genAssign
                                    206 ;	genCopy
      000062 8Dr04r00         [ 4]  207 	sta	_free_next_free_10000_44
      000065 8Er05r00         [ 4]  208 	stx	(_free_next_free_10000_44 + 1)
                                    209 ;	Raw cost for generated ic 34 : (6, 8.000000) count=0.999999
                                    210 ;	../free.c: 62: h = (void HEAPSPACE *)((char HEAPSPACE *)(ptr) - offsetof(struct header, next_free));
                                    211 ;	genCast
                                    212 ;	genCopy
      000068 AEr01r00         [ 4]  213 	ldx	(_free_ptr_10000_43 + 1)
      00006B ADr00r00         [ 4]  214 	lda	_free_ptr_10000_43
                                    215 ;	Raw cost for generated ic 35 : (6, 8.000000) count=0.999999
                                    216 ;	genMinus
                                    217 ;	  genMinusDec - size=2  icount=2
      00006E 38               [ 2]  218 	sec
      00006F E9 02            [ 3]  219 	sbc	#0x02
      000071 B0 01            [ 4]  220 	bcs	00170$
      000073 CA               [ 2]  221 	dex
      000074                        222 00170$:
                                    223 ;	Raw cost for generated ic 36 : (6, 8.600000) count=0.999999
                                    224 ;	genCast
                                    225 ;	genCopy
      000074 8Dr02r00         [ 4]  226 	sta	_free_h_10000_44
      000077 8Er03r00         [ 4]  227 	stx	(_free_h_10000_44 + 1)
                                    228 ;	Raw cost for generated ic 38 : (6, 8.000000) count=0.999999
                                    229 ;	../free.c: 65: h->next_free = next_free;
                                    230 ;	genAssign
                                    231 ;	genCopy
      00007A 85*00            [ 3]  232 	sta	*_free_sloc0_1_0
      00007C 86*01            [ 3]  233 	stx	*(_free_sloc0_1_0 + 1)
                                    234 ;	Raw cost for generated ic 41 : (4, 6.000000) count=0.999999
                                    235 ;	genPointerSet
      00007E ADr04r00         [ 4]  236 	lda	_free_next_free_10000_44
      000081 A0 02            [ 2]  237 	ldy	#0x02
      000083 91*00            [ 6]  238 	sta	[*_free_sloc0_1_0],y
      000085 ADr05r00         [ 4]  239 	lda	(_free_next_free_10000_44 + 1)
      000088 C8               [ 2]  240 	iny
      000089 91*00            [ 6]  241 	sta	[*_free_sloc0_1_0],y
                                    242 ;	Raw cost for generated ic 42 : (13, 24.000000) count=0.999999
                                    243 ;	../free.c: 66: *f = h;
                                    244 ;	genPointerSet
                                    245 ;	  setupDPTR - off=0 remat=(null) savea=0
      00008B AEr08r00         [ 4]  246 	ldx	_free_f_10000_44
      00008E 86*00            [ 3]  247 	stx	*(DPTR+0)
      000090 AEr09r00         [ 4]  248 	ldx	(_free_f_10000_44 + 1)
      000093 86*01            [ 3]  249 	stx	*(DPTR+1)
      000095 ADr02r00         [ 4]  250 	lda	_free_h_10000_44
      000098 A0 00            [ 2]  251 	ldy	#0x00
      00009A 91*00            [ 6]  252 	sta	[DPTR],y
      00009C ADr03r00         [ 4]  253 	lda	(_free_h_10000_44 + 1)
      00009F C8               [ 2]  254 	iny
      0000A0 91*00            [ 6]  255 	sta	[DPTR],y
                                    256 ;	Raw cost for generated ic 44 : (23, 38.000000) count=0.999999
                                    257 ;	../free.c: 68: if(next_free == h->next) // Merge with next block
                                    258 ;	genCast
                                    259 ;	genCopy
      0000A2 85*03            [ 3]  260 	sta	*(_free_sloc1_1_0 + 1)
      0000A4 ADr02r00         [ 4]  261 	lda	_free_h_10000_44
      0000A7 85*02            [ 3]  262 	sta	*_free_sloc1_1_0
                                    263 ;	Raw cost for generated ic 46 : (7, 10.000000) count=0.999999
                                    264 ;	genPointerGet
      0000A9 B1*02            [ 6]  265 	lda	[*_free_sloc1_1_0],y
      0000AB AA               [ 2]  266 	tax
      0000AC 88               [ 2]  267 	dey
      0000AD B1*02            [ 6]  268 	lda	[*_free_sloc1_1_0],y
                                    269 ;	Raw cost for generated ic 47 : (6, 14.000000) count=0.999999
                                    270 ;	genCmpEQorNE
      0000AF CDr04r00         [ 4]  271 	cmp	_free_next_free_10000_44
      0000B2 D0 2E            [ 4]  272 	bne	00105$
      0000B4 ECr05r00         [ 4]  273 	cpx	(_free_next_free_10000_44 + 1)
      0000B7 D0 29            [ 4]  274 	bne	00105$
                                    275 ;	Raw cost for generated ic 48 : (16, 19.200001) count=0.999999
                                    276 ;	skipping generated iCode
                                    277 ;	Raw cost for generated ic 49 : (0, 0.000000) count=0.999999
                                    278 ;	../free.c: 70: h->next_free = h->next->next_free;
                                    279 ;	genAssign
                                    280 ;	genCopy
                                    281 ;	Raw cost for generated ic 57 : (0, 0.000000) count=0.749999
                                    282 ;	genPointerGet
                                    283 ;	  setupDPTR - off=2 remat=(null) savea=0
      0000B9 85*00            [ 3]  284 	sta	*(DPTR+0)
      0000BB 86*01            [ 3]  285 	stx	*(DPTR+1)
      0000BD A0 03            [ 2]  286 	ldy	#0x03
      0000BF B1*00            [ 6]  287 	lda	[DPTR],y
      0000C1 AA               [ 2]  288 	tax
      0000C2 88               [ 2]  289 	dey
      0000C3 B1*00            [ 6]  290 	lda	[DPTR],y
                                    291 ;	Raw cost for generated ic 58 : (12, 22.000000) count=0.749999
                                    292 ;	genPointerSet
      0000C5 91*00            [ 6]  293 	sta	[*_free_sloc0_1_0],y
      0000C7 8A               [ 2]  294 	txa
      0000C8 C8               [ 2]  295 	iny
      0000C9 91*00            [ 6]  296 	sta	[*_free_sloc0_1_0],y
                                    297 ;	Raw cost for generated ic 59 : (6, 16.000000) count=0.749999
                                    298 ;	../free.c: 71: h->next = h->next->next;
                                    299 ;	genPointerGet
      0000CB A0 00            [ 2]  300 	ldy	#0x00
      0000CD B1*02            [ 6]  301 	lda	[*_free_sloc1_1_0],y
      0000CF 85*04            [ 3]  302 	sta	*_free_sloc2_1_0
      0000D1 C8               [ 2]  303 	iny
      0000D2 B1*02            [ 6]  304 	lda	[*_free_sloc1_1_0],y
      0000D4 85*05            [ 3]  305 	sta	*(_free_sloc2_1_0 + 1)
                                    306 ;	Raw cost for generated ic 64 : (11, 20.000000) count=0.749999
                                    307 ;	genPointerGet
      0000D6 B1*04            [ 6]  308 	lda	[*_free_sloc2_1_0],y
      0000D8 AA               [ 2]  309 	tax
      0000D9 88               [ 2]  310 	dey
      0000DA B1*04            [ 6]  311 	lda	[*_free_sloc2_1_0],y
                                    312 ;	Raw cost for generated ic 66 : (6, 14.000000) count=0.749999
                                    313 ;	genPointerSet
      0000DC 91*02            [ 6]  314 	sta	[*_free_sloc1_1_0],y
      0000DE 8A               [ 2]  315 	txa
      0000DF C8               [ 2]  316 	iny
      0000E0 91*02            [ 6]  317 	sta	[*_free_sloc1_1_0],y
                                    318 ;	Raw cost for generated ic 67 : (6, 16.000000) count=0.749999
                                    319 ;	genLabel
      0000E2                        320 00105$:
                                    321 ;	Raw cost for generated ic 68 : (0, 0.000000) count=0.999998
                                    322 ;	../free.c: 74: if (prev_free && prev_free->next == h) // Merge with previous block
                                    323 ;	genIfx
      0000E2 ADr07r00         [ 4]  324 	lda	(_free_prev_free_10000_44 + 1)
      0000E5 0Dr06r00         [ 4]  325 	ora	_free_prev_free_10000_44
                                    326 ;	genIfxJump : z
      0000E8 F0 42            [ 4]  327 	beq	00113$
                                    328 ;	Raw cost for generated ic 69 : (11, 13.600000) count=0.999998
                                    329 ;	genCast
                                    330 ;	genCopy
      0000EA ADr07r00         [ 4]  331 	lda	(_free_prev_free_10000_44 + 1)
      0000ED 85*05            [ 3]  332 	sta	*(_free_sloc2_1_0 + 1)
      0000EF ADr06r00         [ 4]  333 	lda	_free_prev_free_10000_44
      0000F2 85*04            [ 3]  334 	sta	*_free_sloc2_1_0
                                    335 ;	Raw cost for generated ic 73 : (10, 14.000000) count=0.749999
                                    336 ;	genPointerGet
      0000F4 A0 01            [ 2]  337 	ldy	#0x01
      0000F6 B1*04            [ 6]  338 	lda	[*_free_sloc2_1_0],y
      0000F8 AA               [ 2]  339 	tax
      0000F9 88               [ 2]  340 	dey
      0000FA B1*04            [ 6]  341 	lda	[*_free_sloc2_1_0],y
                                    342 ;	Raw cost for generated ic 74 : (8, 16.000000) count=0.749999
                                    343 ;	genCmpEQorNE
      0000FC CDr02r00         [ 4]  344 	cmp	_free_h_10000_44
      0000FF D0 2B            [ 4]  345 	bne	00113$
      000101 ECr03r00         [ 4]  346 	cpx	(_free_h_10000_44 + 1)
      000104 F0 01            [ 4]  347 	beq	00178$
      000106 60               [ 6]  348 	rts
      000107                        349 00178$:
                                    350 ;	Raw cost for generated ic 75 : (16, 19.200001) count=0.749999
                                    351 ;	skipping generated iCode
                                    352 ;	Raw cost for generated ic 76 : (0, 0.000000) count=0.749999
                                    353 ;	../free.c: 76: prev_free->next = h->next;
                                    354 ;	genPointerGet
      000107 C8               [ 2]  355 	iny
      000108 B1*02            [ 6]  356 	lda	[*_free_sloc1_1_0],y
      00010A AA               [ 2]  357 	tax
      00010B 88               [ 2]  358 	dey
      00010C B1*02            [ 6]  359 	lda	[*_free_sloc1_1_0],y
                                    360 ;	Raw cost for generated ic 83 : (7, 16.000000) count=0.562498
                                    361 ;	genPointerSet
      00010E 91*04            [ 6]  362 	sta	[*_free_sloc2_1_0],y
      000110 8A               [ 2]  363 	txa
      000111 C8               [ 2]  364 	iny
      000112 91*04            [ 6]  365 	sta	[*_free_sloc2_1_0],y
                                    366 ;	Raw cost for generated ic 84 : (6, 16.000000) count=0.562498
                                    367 ;	../free.c: 77: prev_free->next_free = h->next_free;
                                    368 ;	genAssign
                                    369 ;	genCopy
      000114 ADr07r00         [ 4]  370 	lda	(_free_prev_free_10000_44 + 1)
      000117 85*05            [ 3]  371 	sta	*(_free_sloc2_1_0 + 1)
      000119 ADr06r00         [ 4]  372 	lda	_free_prev_free_10000_44
      00011C 85*04            [ 3]  373 	sta	*_free_sloc2_1_0
                                    374 ;	Raw cost for generated ic 86 : (10, 14.000000) count=0.562498
                                    375 ;	genPointerGet
      00011E A0 03            [ 2]  376 	ldy	#0x03
      000120 B1*00            [ 6]  377 	lda	[*_free_sloc0_1_0],y
      000122 AA               [ 2]  378 	tax
      000123 88               [ 2]  379 	dey
      000124 B1*00            [ 6]  380 	lda	[*_free_sloc0_1_0],y
                                    381 ;	Raw cost for generated ic 89 : (8, 16.000000) count=0.562498
                                    382 ;	genPointerSet
      000126 91*04            [ 6]  383 	sta	[*_free_sloc2_1_0],y
      000128 8A               [ 2]  384 	txa
      000129 C8               [ 2]  385 	iny
      00012A 91*04            [ 6]  386 	sta	[*_free_sloc2_1_0],y
                                    387 ;	Raw cost for generated ic 90 : (6, 16.000000) count=0.562498
                                    388 ;	genLabel
      00012C                        389 00113$:
                                    390 ;	Raw cost for generated ic 92 : (0, 0.000000) count=0.999997
                                    391 ;	../free.c: 79: }
                                    392 ;	genEndFunction
      00012C 60               [ 6]  393 	rts
                                    394 ;	Raw cost for generated ic 93 : (1, 6.000000) count=0.999997
                                    395 	.area CODE
                                    396 	.area RODATA
                                    397 	.area XINIT
                                    398 	.area CABS    (ABS)
